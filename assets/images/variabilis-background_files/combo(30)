YUI.add("hermes-template-photo-well-media-scrappy",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,l,n){var i,s=null!=a?a:{};return'\t<div class="restricted-interstitial">\n\t\t<div class="restricted-interstitial-message">\n\t\t\t<h2>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:n}))+"</h2>\n"+(null!=(i=e.if.call(s,null!=a?a.isSignedIn:a,{name:"if",hash:{},fn:t.program(2,n,0),inverse:t.program(5,n,0),data:n}))?i:"")+"\t\t</div>\n\t</div>\n"},2:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return"\t\t\t\t<p>"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:n}))+"<br />"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:n}))+"</p>\n\n"+(null!=(i=e.unless.call(s,null!=a?a.isMinor:a,{name:"unless",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?i:"")},3:function(t,a,e,l,n){var i=null!=a?a:{},s=e.helperMissing,h=t.escapeExpression;return"\t\t\t\t\t<p><button class='ui-button'><span>"+h((e.intlMessage||a&&a.intlMessage||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:n}))+"</span></button></p>\n\t\t\t\t\t<p>"+h((e.intlHTMLMessage||a&&a.intlHTMLMessage||s).call(i,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:n}))+"</p>\n"},5:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return"\t\t\t\t<p>"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:n}))+' <a href="//'+r("function"==typeof(i=null!=(i=e.host||(null!=a?a.host:a))?i:h)?i.call(s,{name:"host",hash:{},data:n}):i)+'/signin/" data-track="photoWellSignInClick">'+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:n}))+"</a></p>\n"},7:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.isVideo:a,{name:"if",hash:{},fn:t.program(8,n,0),inverse:t.program(10,n,0),data:n}))?i:""},8:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return'\t\t<div class="videoplayer main-photo" style="width:'+r("function"==typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)?i.call(s,{name:"width",hash:{},data:n}):i)+"px; height:"+r("function"==typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)?i.call(s,{name:"height",hash:{},data:n}):i)+'px;"><video id="video_1" poster="'+r("function"==typeof(i=null!=(i=e.src||(null!=a?a.src:a))?i:h)?i.call(s,{name:"src",hash:{},data:n}):i)+'" class="video-js vjs-big-play-centered inherit-size"></video></div>\n'},10:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.showFuzzy:a,{name:"if",hash:{},fn:t.program(11,n,0),inverse:t.program(13,n,0),data:n}))?i:""},11:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return'\t\t\t<span class="restricted-image main-photo" style="width:'+r("function"==typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)?i.call(s,{name:"width",hash:{},data:n}):i)+"px;height:"+r("function"==typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)?i.call(s,{name:"height",hash:{},data:n}):i)+'px;"></span>\n'},13:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r="function",o=t.escapeExpression;return'\t\t\t<span class="facade-of-protection-neue" style="width:'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+"px;height:"+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'px;">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||h).call(s,null!=a?a["zoom-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||h).call(s,null!=a?a["vr-overlay-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\t\t\t</span>\n\n\t\t\t<img width="'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.src||(null!=a?a.src:a))?i:h)===r?i.call(s,{name:"src",hash:{},data:n}):i)+'" class="low-res-photo" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t\t<img width="'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.highResSrc||(null!=a?a.highResSrc:a))?i:h)===r?i.call(s,{name:"highResSrc",hash:{},data:n}):i)+'" class="main-photo is-hidden" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t\t<script nonce="'+o(typeof(i=null!=(i=e.cspNonce||(null!=a?a.cspNonce:a))?i:h)===r?i.call(s,{name:"cspNonce",hash:{},data:n}):i)+"\">\n\t\t\t\tvar img = document.querySelector('.photo-well-media-scrappy-view img.main-photo');\n\t\t\t\timg.onload = function () { registerFirstPhoto(img); };\n\t\t\t<\/script>\n\t\t\t<noscript>\n\t\t\t\t<img width=\""+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.highResSrc||(null!=a?a.highResSrc:a))?i:h)===r?i.call(s,{name:"highResSrc",hash:{},data:n}):i)+'" class="main-photo" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t\t</noscript>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.needsInterstitial:a,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(7,n,0),data:n}))?i:""},useData:!0}),l={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(l[a]=e)}),t.Template.register("hermes/photo-well-media-scrappy",function(a,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,e(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-moola-view",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,r){return'\t\t\t\t\t\t<a target="_blank" href="/account/upgrade/pro" title="Flickr Pro">Flickr Pro</a>\n'},3:function(t,a,e,n,r){return'\t\t\t\t\t\t<a href="#" class="sponsored-title" title="Sponsored Advertiser">Sponsored Advertiser</a>\n'},5:function(t,a,e,n,r){return'\t\t\t\t\t\t\t<a target="_blank" href="/account/upgrade/pro">Sign up today!</a>\n'},7:function(t,a,e,n,r){return'\t\t\t\t\t\t\t<a target="_blank" href="https://help.flickr.com/en_us/ad-free-browsing-sharing-SJxW22miyX">Learn more about ads</a>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,e,n,r){var i,o,s=null!=a?a:{};return'<div class="sub-photo-container centered-content">\n\t<div class="sub-photo-content-container">\n\t\t<div class="view sub-photo-left-view">\n\t\t\t<div class="attribution-view photo-attribution">\n\t\t\t\t<a class="attribution-icon no-menu circle-icon" href="#" data-track="ad_link_rail_icon" target="_blank">\n\t\t\t\t\t<img src="'+t.escapeExpression("function"==typeof(o=null!=(o=e.assetRoot||(null!=a?a.assetRoot:a))?o:e.helperMissing)?o.call(s,{name:"assetRoot",hash:{},data:r}):o)+'/images/general/moola.png"/>\n\t\t\t\t</a>\n\n\t\t\t\t<div class="attribution-info">\n'+(null!=(i=e.if.call(s,null!=a?a.isProUpsell:a,{name:"if",hash:{},fn:t.program(1,r,0),inverse:t.program(3,r,0),data:r}))?i:"")+'\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="view sub-photo-title-desc-view" id="yui_3_16_0_rc_1_1_1401741750198_2372">\n\t\t\t\t<div class="title-desc-block">\n\t\t\t\t\t<span class=" meta-field photo-title ">\n'+(null!=(i=e.if.call(s,null!=a?a.isProUpsell:a,{name:"if",hash:{},fn:t.program(5,r,0),inverse:t.program(7,r,0),data:r}))?i:"")+'\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="view sub-photo-right-view">\n\t\t\t<a href="/account/upgrade/pro" class="find-out-more" data-track="ad_link_rail_panel" target="_blank">\n\t\t\t\tAd free browsing? Sign up for Flickr Pro\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),n={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)}),t.Template.register("hermes/sub-photo-moola-view",function(a,r){return r=r||{},r.partials=r.partials?t.merge(n,r.partials):n,e(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-prbd-moola-position",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,t){return"data-aa-targeting="+a.escapeExpression((n.json||e&&e.json||n.helperMissing).call(null!=e?e:{},null!=e?e.audienceTargets:e,{name:"json",hash:{},data:t}))},3:function(a,e,n,l,t){return"upsell-fallback"},5:function(a,e,n,l,t){return'\t\t<a href="/account/upgrade/pro?feed"></a>\n'},7:function(a,e,n,l,t){var s;return null!=(s=(n.isFlipped||e&&e.isFlipped||n.helperMissing).call(null!=e?e:{},"enable-ad-timer-lock",{name:"isFlipped",hash:{},fn:a.program(8,t,0),inverse:a.noop,data:t}))?s:""},8:function(a,e,n,l,t){return'\t\t<div class="navad-timer-container">\n\t\t\t<p class="navad-timer-text">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{adTimerStartCount:null!=e?e.adTimerStartCount:e,intlName:"common.AD_INTERSTITIAL_TIMER"},data:t}))+"</p>\n\t\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,t){var s,i,r=null!=e?e:{},o=n.helperMissing,p=a.escapeExpression;return'<div data-aaad="true" data-aa-adunit="'+p("function"==typeof(i=null!=(i=n.adUnit||(null!=e?e.adUnit:e))?i:o)?i.call(r,{name:"adUnit",hash:{},data:t}):i)+'" '+(null!=(s=(n.isFlipped||e&&e.isFlipped||o).call(r,"enable-audience-tgt",{name:"isFlipped",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?s:"")+' class="moola-container '+p("function"==typeof(i=null!=(i=n.class||(null!=e?e.class:e))?i:o)?i.call(r,{name:"class",hash:{},data:t}):i)+" "+(null!=(s=n.if.call(r,null!=e?e.upsellFallback:e,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.noop,data:t}))?s:"")+'">\n'+(null!=(s=n.if.call(r,null!=e?e.upsellFallback:e,{name:"if",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?s:"")+'</div>\n<p class="upgrade-to-pro-cta"><a href="/account/upgrade/pro">'+p((n.intlMessage||e&&e.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"common.UPGRADE_PRO_HIDE_ADS"},data:t}))+"</a></p>\n"+(null!=(s=n.if.call(r,null!=e?e.signedOut:e,{name:"if",hash:{},fn:a.program(7,t,0),inverse:a.noop,data:t}))?s:"")},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/prbd-moola-position",function(e,t){return t=t||{},t.partials=t.partials?a.merge(l,t.partials):l,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-well-media-interstitial-moola",function(a,e){var t=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,t,l,r){var i;return'<div class="photo-page-i-m-container">\n'+(null!=(i=a.invokePartial(l["prbd-moola-position"],e,{name:"prbd-moola-position",hash:{audienceTargets:null!=e?e.audienceTargets:e,signedOut:null!=e?e.signedOut:e,upsellFallback:null!=e?e.upsellFallback:e,adUnit:null!=e?e.adUnit:e,adTimerStartCount:null!=e?e.adTimerStartCount:e},data:r,indent:"\t",helpers:t,partials:l,decorators:a.decorators}))?i:"")+"</div>\n"},usePartial:!0,useData:!0}),l={};a.Array.each(["prbd-moola-position"],function(e){var t=a.Template.get("hermes/"+e);t&&(l[e]=t)}),a.Template.register("hermes/photo-well-media-interstitial-moola",function(e,r){return r=r||{},r.partials=r.partials?a.merge(l,r.partials):l,t(e,r)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-prbd-moola-position"]});YUI.add("photo-well-media-scrappy-view",function(e,t){var i,n=require("hermes-core/flog")(t);i={photo:{render:function(){var e,t,i,n=this,o=this.get("photo"),a="";return n.preloadImage&&(n.preloadImage.onload=null),this.appContext.forceServerRender?t=e=this.getPhotoForDisplay({canvas:{width:Number.MAX_VALUE,height:Number.MAX_VALUE}}):(e=this.getPhotoForDisplay(),t=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]})),o.getValue("owner")&&(a=""===o.getValue("title").trim()?this.intlMessage({intlName:"common.UNTITLED"}):o.getValue("title"),a+=" | "+this.intlMessage({intlName:"common.BY_USER",user:o.getValue("owner").getValue("username")})),(i=this.get("container").one(".main-photo"))&&parseInt(i.getAttribute("width"),10)===e.width&&parseInt(i.getAttribute("height"),10)===e.height||this.setContainerWithTemplate("photo-well-media-scrappy",{width:e.width,height:e.height,src:t.url,highResSrc:e.url,imgAltText:a,needsInterstitial:o.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:!1,isMinor:this.appContext.getViewer().isMinor}),YUI.Env.isServer?(this.serverWidth=e.width,this.serverHeight=e.height):o.getValue("needsInterstitial")||(n.preloadImage=new Image,n.preloadImage.onload=function(){if(!this.onloadFired&&n.isActiveAndInDOM()){this.onloadFired=!0;var e=n.get("container").one(".low-res-photo");n.get("container").one(".main-photo").removeClass("is-hidden").show(),e.hide()}},n.preloadImage.src=e.url,n.preloadImage.complete&&n.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]}),i=t.url;return this.appContext.flipper.isFlipped("disable-video-playback")&&(i="/images/en-us/video-unavailable.png"),!this.player||e.getValue("isVideoPending")||e.getValue("isVideoFailed")?(this.setContainerWithTemplate("photo-well-media-scrappy",{width:t.width,height:t.height,src:i,needsInterstitial:e.getValue("needsInterstitial"),isVideo:!0,isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this):(e.getValue("isVideoPending")||e.getValue("isVideoFailed")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){var t=e.config.flickr.moola.positions.interstitials[0],i={},n=this.appContext.viewportData.getWidth(),o=e.config.flickr.moola.ad_breakpoint_mobile_desktop;return this.adId=e.guid(),i.signedOut=!this.appContext.getViewer().signedIn,i.adTimerStartCount=t.ad_timer_start_value,i.adUnit=t[n<o?"ad_unit_mobile":"ad_unit_desktop"],i.audienceTargets=this.appContext.audienceTargets.getAudienceData(),this.setContainerWithTemplate("photo-well-media-interstitial-moola",i),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"vr-overlay-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,destinationContainer:".photo-well-media-scrappy-view",disabled:function(){return!this.appContext.flipper.isFlipped("enable-vr")}}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.adSlots=[],""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(i){if(t.set("photo",i),i.getValue("isVideo"))return new e.Promise(function(t,i){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):this.get("photo").getValue("isVideo")?i.video.render.call(this):i.photo.render.call(this),!YUI.Env.isServer&&this.subviews["vr-overlay-view"]&&this.subviews["vr-overlay-view"].get("canVr")&&(this.canVR=!0,this.subviews["zoom-view"]&&this.subviews["zoom-view"].destroy({remove:!0})),this.get("photo").getValue("needsInterstitial")?this.get("container").addClass("has-interstitial"):this.get("container").removeClass("has-interstitial"),this},handleInterstitialDismissButtonClick:function(t){var i=this,o=this.get("personPreferences"),a=this.get("photo"),s=a.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),o.setValue("safeSearch",s),o.registry.remoteUpdate(i.appContext.auth.user.nsid).then(function(e){a.registry.attributeSearch({needsInterstitial:!0}).forEach(function(e){a.registry.getValue(e,"safetyLevel")<=o.getValue("safeSearch")&&a.registry.setValue(e,"needsInterstitial",!1)}),i.buildContainer(),i.fire("subviewViewEvent","photoWellResized")},function(e){n.error({err:e}),i.onError(i.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},onParentViewEvent:function(e,t){t&&"photoWellResized"===t[0]&&(this.get("photo").getValue("needsInterstitial")||(this.set("canvasSizeIsDirty",!0),this.buildContainer()))},activate:function(){var t=this;return!this.get("photo").getValue("isVideo")||this.get("photo").getValue("isVideoPending")||this.get("photo").getValue("isVideoFailed")||(this.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1").getDOMNode():null,controlBar:{fullscreenToggle:!1}}),this.player.init(),this.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",this.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.get("container").one(".restricted-interstitial-message button")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this.appContext.flipper.isFlipped("enable-sticky-ads")&&this.appContext.allowThirdPartyContent&&this.appContext.adManager.handleInfolinks(this.get("photo").getValue("owner").getValue("isPro")),this.isAd&&(this.appContext.flipper.isFlipped("enable-sticky-ads")&&this.appContext.adManager.stopInfolinksAdUnit(),asc.cmd.push(asc.processAdsOnPage),e.once("adPageChange",function(){t.fire("subviewViewEvent","adPageTimeoutStart")})),this},showUpsell:function(){var e=this.get("container"),t=e.one("#interstitial-photo-upsell"),i=e.one("iframe");t&&t.addClass("show-upsell"),i&&i.setStyle("display","none")},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"}).show()},getPhotoForDisplay:function(e){var t,i,n,o=this.getCanvasSize(),a=this.getPixelRatio();return e&&e.canvasSize&&(o=e.canvasSize),t=this.get("photo").getSizeToFit(o,e),i=Math.min(o.height/a,t.height),n=Math.min(o.width/a,t.width/t.height*i),i=Math.min(i,t.height/t.width*n),{width:Math.round(n),height:Math.round(i),url:t.url,pixelRatio:t.width/n}},getCanvasSize:function(){var e,t,i,n,o,a,s=this.getPixelRatio(),r=this.get("container"),h={width:500,height:500};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(t=this.get("container").ancestor(),i=r.getStyle("paddingTop")?parseInt(r.getStyle("paddingTop").match(/[0-9]+/)[0],10):0,n=r.getStyle("paddingBottom")?parseInt(r.getStyle("paddingBottom").match(/[0-9]+/)[0],10):0,a=40,o=40,t&&((e=t.get("region")).height=parseInt(t.getStyle("height").match(/[0-9]+/)[0],10)-(i+n),e.width=this.appContext.viewportData.viewport.width-(a+o))):e=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(h={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),e||(e={top:0,left:0,bottom:500,right:500,width:h.width,height:h.height}),e.height*=s,e.width*=s,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","moment","vr-overlay-view","zoom-view","hermes-template-photo-well-media-scrappy","hermes-template-sub-photo-moola-view","hermes-template-photo-well-media-interstitial-moola"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-context-slider-photo",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,t){return" currentImage"},3:function(a,e,n,l,t){return" previousImages"},5:function(a,e,n,l,t){return" nextImages"},7:function(a,e,n,l,t){return" restricted-image"},9:function(a,e,n,l,t){return"\t\t<span class='play-slideshow'>&#9654;</span>\n\t\t<span class='countdown-slideshow'></span>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,t){var r,o,i=null!=e?e:{},s=n.helperMissing,u="function",c=a.escapeExpression;return'<a class="context-thumb emptyImage'+(null!=(r=n.if.call(i,null!=e?e.currentPhoto:e,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?r:"")+(null!=(r=n.if.call(i,null!=e?e.previousBigPhotos:e,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.noop,data:t}))?r:"")+(null!=(r=n.if.call(i,null!=e?e.nextBigPhotos:e,{name:"if",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?r:"")+(null!=(r=n.if.call(i,null!=e?e.needsInterstitial:e,{name:"if",hash:{},fn:a.program(7,t,0),inverse:a.noop,data:t}))?r:"")+'" href="'+c(typeof(o=null!=(o=n.url||(null!=e?e.url:e))?o:s)===u?o.call(i,{name:"url",hash:{},data:t}):o)+'" data-track="contextSliderNextPhotoClick" style="background-image: url('+c(typeof(o=null!=(o=n.background||(null!=e?e.background:e))?o:s)===u?o.call(i,{name:"background",hash:{},data:t}):o)+"); left: "+c(typeof(o=null!=(o=n.left||(null!=e?e.left:e))?o:s)===u?o.call(i,{name:"left",hash:{},data:t}):o)+'px" data-photo-id="'+c(typeof(o=null!=(o=n.id||(null!=e?e.id:e))?o:s)===u?o.call(i,{name:"id",hash:{},data:t}):o)+'" title="'+c(typeof(o=null!=(o=n.title||(null!=e?e.title:e))?o:s)===u?o.call(i,{name:"title",hash:{},data:t}):o)+'" tabindex="-1">\n'+(null!=(r=n.if.call(i,null!=e?e.currentPhoto:e,{name:"if",hash:{},fn:a.program(9,t,0),inverse:a.noop,data:t}))?r:"")+"</a>\n"},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/context-slider-photo",function(e,t){return t=t||{},t.partials=t.partials?a.merge(l,t.partials):l,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});